{{ config(materialized="table") }}

with
    ca_msrmnt_contxt_val_typ_raw_stg as (select * from ca_msrmnt_contxt_val_typ_raw),
    lkptrans as (
        select stg.msrmnt_reslt_id, raw_stg.*
        from ca_msrmnt_contxt_val_typ_raw_stg raw_stg
        left outer join
            ca_msrmnt_reslt_stg stg on stg.msrmnt_id = raw_stg."MeasResultID"
    ),
    filtrans as (
        select distinct
            "MeasResultID" as cxkey_msrmnt_id,
            "TestCondition_Context_Val_Type" as test_cond_cntxt_val_typ,
            "TestCondition_ContextName" as test_cond_contxt_nm,
            "TestCondition_ActualValue" as test_cond_contxt_act_val,
            "TestCondition_Units" as test_cond_unt,
            "TestCondition_IsExpected" as test_cond_is_expt_ind,
            "TestCondition_Offset" as test_cond_offset_val,
            "TestCondition_Indent" as test_cond_indent,
            "TestCondition_AltContent" as test_cond_altcontent,
            "Column2_ContextName" as col2_cntxt_val_typ,
            "Column2_Context_Val_Type" as col2_contxt_nm,
            "Column2_ActualValue" as col2_contxt_act_val,
            "Column2_Units" as col2_unt,
            "Column2_IsExpected" as col2_is_expt_ind,
            "Column2_Offset" as col2_offset_val,
            "Column2_Indent" as col2_indent,
            "Column2_AltContent" as col2_altcontent,
            "Column3_Context_Val_Type" as col3_cntxt_val_typ,
            "Column3_ContextName" as col3_contxt_nm,
            "Column3_ActualValue" as col3_contxt_act_val,
            "Column3_Units" as col3_unt,
            "Column3_IsExpected" as col3_is_expt_ind,
            "Column3_Offset" as col3_offset_val,
            "Column3_Indent" as col3_indent,
            "Column3_AltContent" as col3_altcontent,
            "Column4_Context_Val_Type" as col4_cntxt_val_typ,
            "Column4_ContextName" as col4_contxt_nm,
            "Column4_ActualValue" as col4_contxt_act_val,
            "Column4_Units" as col4_unt,
            "Column4_IsExpected" as col4_is_expt_ind,
            "Column4_Offset" as col4_offset_val,
            "Column4_Indent" as col4_indent,
            "Column4_AltContent" as col4_altcontent,
            "Column5_Context_Val_Type" as col5_contxt_nm,
            "Column5_ContextName" as col5_cntxt_val_typ,
            "Column5_ActualValue" as col5_contxt_act_val,
            "Column5_Units" as col5_unt,
            "Column5_IsExpected" as col5_is_expt_ind,
            "Column5_Offset" as col5_offset_val,
            "Column5_Indent" as col5_indent,
            "Column5_AltContent" as col5_altcontent,
            "Column6_Context_Val_Type" as col6_cntxt_val_typ,
            "Column6_ContextName" as col6_contxt_nm,
            "Column6_ActualValue" as col6_contxt_act_val,
            "Column6_Units" as col6_unt,
            "Column6_IsExpected" as col6_is_expt_ind,
            "Column6_Offset" as col6_offset_val,
            "Column6_Indent" as col6_indent,
            "Column6_AltContent" as col6_altcontent,
            "Column7_Context_Val_Type" as col7_cntxt_val_typ,
            "Column7_ContextName" as col7_contxt_nm,
            "Column7_ActualValue" as col7_contxt_act_val,
            "Column7_Units" as col7_unt,
            "Column7_IsExpected" as col7_is_expt_ind,
            "Column7_Offset" as col7_offset_val,
            "Column7_Indent" as col7_indent,
            "Column7_AltContent" as col7_altcontent,
            "Column8_Context_Val_Type" as col8_cntxt_val_typ,
            "Column8_ContextName" as col8_contxt_nm,
            "Column8_ActualValue" as col8_contxt_act_val,
            "Column8_Units" as col8_unt,
            "Column8_IsExpected" as col8_is_expt_ind,
            "Column8_Offset" as col8_offset_val,
            "Column8_Indent" as col8_indent,
            "Column8_AltContent" as col8_altcontent,
            "Column9_Context_Val_Type" as col9_cntxt_val_typ,
            "Column9_ContextName" as col9_contxt_nm,
            "Column9_ActualValue" as col9_contxt_act_val,
            "Column9_Units" as col9_unt,
            "Column9_IsExpected" as col9_is_expt_ind,
            "Column9_Offset" as col9_offset_val,
            "Column9_Indent" as col9_indent,
            "Column9_AltContent" as col9_altcontent,
            "Column10_Context_Val_Type" as col10_cntxt_val_typ,
            "Column10_ContextName" as col10_contxt_nm,
            "Column10_ActualValue" as col10_contxt_act_val,
            "Column10_Units" as col10_unt,
            "Column10_IsExpected" as col10_is_expt_ind,
            "Column10_Offset" as col10_offset_val,
            "Column10_Indent" as col10_indent,
            "Column10_AltContent" as col10_altcontent,
            "Minimum_Context_Val_Type" as min_cntxt_val_typ,
            "Minimum_ContextName" as min_contxt_nm,
            "Minimum_ActualValue" as min_contxt_act_val,
            "Minimum_Units" as min_unt,
            "Minimum_IsExpected" as min_is_expt_ind,
            "Minimum_Offset" as min_offset_val,
            "Minimum_Indent" as min_indent,
            "Minimum_AltContent" as min_altcontent,
            "Measured_Context_Val_Type" as measured_cntxt_val_typ,
            "Measured_ContextName" as measured_contxt_nm,
            "Measured_ActualValue" as measured_contxt_act_val,
            "Measured_Units" as measured_unt,
            "Measured_IsExpected" as measured_is_expt_ind,
            "Measured_Offset" as measured_offset_val,
            "Measured_Indent" as measured_indent,
            "Measured_AltContent" as measured_altcontent,
            "Maximum_Context_Val_Type" as max_cntxt_val_typ,
            "Maximum_ContextName" as max_contxt_nm,
            "Maximum_ActualValue" as max_contxt_act_val,
            "Maximum_Units" as max_unt,
            "Maximum_IsExpected" as max_is_expt_ind,
            "Maximum_Offset" as max_offset_val,
            "Maximum_Indent" as max_indent,
            "Maximum_AltContent" as max_altcontent,
            "AppliedUncertainty_Context_Val_Type" as app_uncrtnty_cntxt_val_typ,
            "AppliedUncertainty_ContextName" as app_uncrtnty_contxt_nm,
            "AppliedUncertainty_ActualValue" as app_uncrtnty_contxt_act_val,
            "AppliedUncertainty_Units" as app_uncrtnty_unt,
            "AppliedUncertainty_IsExpected" as app_uncrtnty_is_expt_ind,
            "AppliedUncertainty_Offset" as app_uncrtnty_offset_val,
             "AppliedUncertainty_Indent" as app_uncrtnty_indent,
            "AppliedUncertainty_AltContent" as app_uncrtnty_altcontent
        from lkptrans
    -- where MSRMNT_RESLT_ID is not null
    )
select *
from filtrans
